Context

Login screen renders but email/password auth rejects valid users with “Invalid credentials.” No sign-up or verification flow exists.

App stack: Replit monorepo with client (React/Vite/TS) and server (Node/TS) and existing /api/* endpoints.

Rules

Minimal changes; match existing patterns and file structure.

Reuse current auth middleware/session store if present.

Keep UI styling consistent with current login card.

Tasks

Add backend endpoints:

POST /api/auth/register to create user with email, passwordHash, verified=false, and a verifyToken expiring in 24h.

POST /api/auth/verify to consume verifyToken and set verified=true.

Rate-limit both endpoints.

Implement password hashing and validation using the same crypto lib used in login (e.g., bcrypt/argon2). Do not change existing login schema; only extend.

Email delivery:

Add email sender module with provider adapter (Resend/Postmark/SendGrid). In dev, use a console/file transport; in prod, use provider.

Send “Verify your email” message with one-time link to /verify?token=....

Frontend:

Add “Create account” CTA beneath the login form -> modal/page with fields email, password, confirm password, checkbox for ToS.

Add /verify route that hits POST /api/auth/verify and shows success/failure state, then link to Sign In.

Surface server errors inline; keep styles identical to login inputs.

Guardrails:

Disallow login when verified=false. Return specific error “Email not verified” with “Resend email” action that calls POST /api/auth/resend.

Add POST /api/auth/resend with cooldown.

Tests:

Add API tests for register/verify/resend/login happy paths and token expiry/invalid token.

Add minimal UI test that completes register -> intercept verification -> verify -> login.

Deliverables

Updated server auth routes, email sender module, and rate limiter.

Updated client login screen with Sign Up and Verify views.

ENV template updated with mail provider vars.

Brief change log listing files touched and endpoints added.

Acceptance Criteria

New user can register and receives a verification email (or dev console message with the link).

Visiting the verification link flips verified to true and invalidates the token.

Unverified users cannot log in and see “Email not verified,” with working resend.

Rate limits active on register and resend.

Existing login for already-created verified users remains unchanged.

All new tests pass; no regressions in current auth flow.

Verification

In dev, register test@example.com and capture verification link from console/file transport.

Hit link; expect success UI and DB shows verified=true.

Attempt login before verify -> blocked; after verify -> success session.

Trigger resend twice rapidly -> second call rate-limited.

Run test suite; confirm all new tests pass and no existing ones fail.

Hidden dependencies / blockers

Mail provider API key (Resend/Postmark/SendGrid) for production.

DB fields: users.email (unique), users.passwordHash, users.verified, email_verifications(userId, token, expiresAt) or equivalent columns on users.

Existing session/JWT secret configured.