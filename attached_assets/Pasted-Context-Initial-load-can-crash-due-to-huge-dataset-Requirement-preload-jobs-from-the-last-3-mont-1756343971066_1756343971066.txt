Context

Initial load can crash due to huge dataset.

Requirement: preload jobs from the last 3 months and only those with valuation ≥ $1,000,000.

Rules

Minimal changes; reuse existing filter/state/query code.

URL/query params must override defaults if present.

Keep slider UI showing 0–$100M+, but initialize filter state to $1M–$100M+.

Tasks

Client default filter state

In filter store/init (e.g., client/src/state/filters.ts), set:

dateFrom = today - 3 months (start of day), dateTo = today (end of day).

minValue = 1_000_000, keep maxValue = 100_000_000 (treated as unbounded).

Ensure URL params, if present, override these defaults.

Initial fetch guard

In jobs fetch hook, if no filters provided, use the above defaults. Remove any code that sends empty range causing full scan.

Server-side safety defaults

In jobs list controller, when params missing, apply:

WHERE start_date BETWEEN :dateFrom AND :dateTo

AND valuation >= 1000000

Omit upper valuation cap if maxValue === 100_000_000.

Indexes (performance)

Verify indexes on start_date and valuation. If missing, add migration to create composite index (start_date, valuation).

UI cues

In sidebar, prefill date inputs with last 3 months and set slider to $1M left knob. Optional small caption “Showing last 3 months, ≥ $1M”.

QA

Test with and without query params, and after refresh. Confirm counts and map markers match filtered data.

Deliverables

Updated client filter defaults.

Updated server controller defaults.

Migration for indexes if needed.

Brief change log.

Acceptance Criteria

First load shows only jobs with start_date ∈ [today-3mo, today] and valuation ≥ $1M.

URL with custom filters overrides defaults.

Slider shows left handle at $1M. Date inputs show last 3 months.

No timeouts or 500s on initial load.

API /api/jobs?... reflects applied defaults when no URL params are given.

Verification

Hard refresh with no query params: confirm reduced job count and fast load.

Inspect Network: request includes dateFrom, dateTo, minValue=1000000; maxValue omitted or 100000000.

Change filters, copy URL, reload: filters persist and override defaults.

Temporarily remove client defaults: server still applies safe defaults.